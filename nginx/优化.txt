优化.txt

https://www.cnblogs.com/dazhidacheng/p/7772451.html
gzip压缩优化
2．    expires缓存有还
3．    网络IO事件模型优化
4．    隐藏软件名称和版本号
5．    防盗链优化
6．    禁止恶意域名解析
7．    禁止通过IP地址访问网站
8．    HTTP请求方法优化
9．    防DOS攻击单IP并发连接的控制，与连接速率控制
10.    严格设置web站点目录的权限
11.    将nginx进程以及站点运行于监牢模式
12.    通过robot协议以及HTTP_USER_AGENT防爬虫优化
13.    配置错误页面根据错误码指定网页反馈给用户
14.    nginx日志相关优化访问日志切割轮询，不记录指定元素日志、最小化日志目录权限
15.    限制上传到资源目录的程序被访问，防止木马入侵系统破坏文件
16.    FastCGI参数buffer和cache配置文件的优化
17.    php.ini和php-fpm.conf配置文件的优化
18.    有关web服务的Linux内核方面深度优化（网络连接、IO、内存等）
19.    nginx加密传输优化（SSL）
20.    web服务器磁盘挂载及网络文件系统的优化
21.    使用nginx cache

################## 基本优化

隐藏版本信息
在http模块下加入：
server_tokens off;

隐藏nginx要修改源代码
1 /home/oldboy/tools/nginx-1.6.3/src/core/nginx.h 第14，16行
2 #define NGINX_VERSION  "1.6.2" 修改为想要的版本号如2.4.3
3 #define NGINX_VER "nginx/" NGINX_VERSION 将nginx修改为想要修改的软件名称，如Apache。

更改nginx服务的默认用户
第一种方法：

   　直接更改配置文件nginx.conf.default参数，将默认的#user nobody;改为user nginx.nginx;

第二种方法：

　　直接在编译nginx的时候指定用户和用户组命令如下：

　　./configure --prefix=/application/nginx-1.6.3 --user=nginx --group=nginx --with-http_ssl_module --with-http_stub_status_module

　降权启动nginx

1 useradd inca
2 cd /home/inca/
3 mkdir conf logs www
4 echo inca >www/index.html
5 chown -R inca.inca *
6 ln -s /application/nginx/conf/mime.types conf/mime.types  #mime.types媒体类型文件

################# 对工作进程的优化

worker_processes  1;一般调整到与CPU的颗数相同

(1)查看LInux可查看CPU个数及总核数

grep processor /proc/cpuinfo|wc -l

(2)查看CPU总颗数

grep 'physical id' /proc/cpuinfo|sort|uniq|wc -l

　默认情况下，nginx的进程跑在某一个CPU或CPU的某一个核上，导致nginx进程使用硬件的资源不均，本节的优化是不同的nginx进程给不同的CPU处理，充分有效的利用有效的硬件资源

　　四核cpu配置

worker_processes    4;
worker_cpu_affinity 0001 0010 0100 1000;
　　双核配置

worker_processes    2;
worker_cpu_affinity 0101 1010;

##################长链接 优化
    sendfile   on;
    tcp_nopush on;
    tcp_nodelay on;
    server_tokens off;
    server_names_hash_bucket_size 128;
    server_names_hash_max_size 512;
    keepalive_timeout  65;
    client_header_timeout 15s;
    client_body_timeout 15s;
    send_timeout 60s;

#################压缩优化
　　gzip on;
　　gzip_min_length  1k;
　　gzip_buffers     4 32k;
　　gzip_http_version 1.1;
　　gzip_comp_level 9;
　　gzip_types  text/css text/xml application/javascript;
　　gzip_vary on;

###############客户端缓存

把常用的直接缓存到客户端浏览器
expires 开启客户端缓存